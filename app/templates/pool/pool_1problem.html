{% extends "pool/pool_header.html" %}
{% block pool_body %}

<script>
    function RenderStatement() {
      var input = prevent_injection(document.getElementById("statement_textarea").value);
      document.getElementById("statement_latex_output").innerHTML = render_multiline_text(input);
      MathJax.Hub.Queue(["Typeset",MathJax.Hub,"statement_latex_output"]);
      }
    function RenderSolution() {
      var input = prevent_injection(document.getElementById("solution_textarea").value);
      document.getElementById("solution_latex_output").innerHTML = render_multiline_text(input);
      MathJax.Hub.Queue(["Typeset",MathJax.Hub,"solution_latex_output"]);
    }
    </script>

{% if current_user.get_pool_relation(current_pool.id).role.isOwner() %}
    <div class="flex justify-end">
        <form action="/archive/publish/{{current_problem.id}}" method="post">
            <input type="submit" class="hover:cursor-pointer px-12 py-2 rounded-xl text-lg text-white font-semibold bg-blue-500 hover:bg-blue-600 active:bg-blue-700" value="Опубликовать в архив">
        </form>
    </div>
{% endif %}

<form action="/pool/{{ current_pool.hashed_id }}/problem/{{ current_problem.id }}" method="post" class="w-full mt-2 px-4">

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% for category, message in messages %}
            {% if category == "danger" %}
                <div class="w-1/2 text-stone-800 text-semibold rounded p-6 text-lg text-center bg-red-400 border-2 border-solid border-red-600">{{ message }}</div>
            {% elif category == "warning" %}
                <div class="w-1/2 text-stone-800 text-semibold rounded p-6 text-lg text-center bg-yellow-400 border-2 border-solid border-yellow-600">{{ message }}</div>
            {% elif category == "success" %}
                <div class="w-1/2 text-stone-800 text-semibold rounded p-6 text-lg text-center bg-green-400 border-2 border-solid border-green-600">{{ message }}</div>
            {% endif %}
        {% endfor %}
    {% endwith %}

    <div class="flex flex-row items-center mt-4">
        <span class="mr-4 text-2xl font-bold">{{ current_problem.name }}</span>
        <input type="submit" value="Сохранить" class="hover:cursor-pointer px-8 py-2 rounded-xl text-lg text-white font-semibold bg-green-500 hover:bg-green-600 active:bg-green-700">
    </div>
    
    <span class="text-slate-500 font-bold text-xl">Название:</span>
    <div class="flex w-full">
        <textarea rows="1" cols="50" name="name" class="text-lg w-full p-4 border-slate-200 border-2 rounded-lg">{{ current_problem.name }}</textarea>
    </div>

    <span class="text-slate-500 font-bold text-xl">Условие:</span>
    <div class="flex w-full">
        <textarea id="statement_textarea" rows="10" cols="50" name="statement" class="text-lg w-1/2 p-4 border-slate-200 border-2 rounded-lg" oninput="RenderStatement();">{{ current_problem.statement }}</textarea>
        <div id="statement_latex_output" class="mathjax-class text-lg ml-4 p-4 bg-white border-2 border-solid border-sky-400 rounded-lg w-1/2"></div>
    </div>
    

    <span class="text-slate-500 font-bold text-xl">Решение:</span>
    <div class="flex w-full">
        <textarea id="solution_textarea" rows="10" cols="50" name="solution" class="text-lg w-1/2 p-4 border-slate-200 border-2 rounded-lg" oninput="RenderSolution();">{{ current_problem.solution }}</textarea>
        <div id="solution_latex_output" class="mathjax-class text-lg ml-4 p-4 bg-white border-2 border-solid border-sky-400 rounded-lg w-1/2"></div>
    </div>
    
</form>

<script>
    RenderStatement();
</script>
<script>
    RenderSolution();
</script>

{% endblock %}